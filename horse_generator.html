<!DOCTYPE html>
<html>

<head>
    <title>JSXGraph Example</title>
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <style>
        #box {
            min-width: 590px;
            height: 700px;
            background-color: #c9c9c9;
            margin: 8px;
        }

        form {
            margin: 8px;
            margin-top: 16px;
            font-size: smaller;
        }

        button {
            margin: 8px;
        }

        #text {
            width: 1000px
        }

        #flex {
            display: flex
        }

        #foal-sex-display,
        #foal-genotype-display {
            border: #453a35 1px solid;
            padding: 5px;
        }

        #test {
            background-color: #453a35
        }
    </style>
</head>

<body>
    <div id="flex">
        <div id="box" class="jxgbox"></div>
        <!-- <div><button onclick="logCoordsAsArray()">log</button></div> -->
        <form id="genotype-form-dam" onchange="updateDamGenotype()">
            <fieldset>
                <legend>Rautiastekijä - emä</legend>
                <label><input type="radio" id="EE" name="E" value="EE" checked> EE - ei-rautias</label><br>
                <label><input type="radio" id="Ee" name="E" value="Ee"> Ee - ei-rautias kantaja</label><br>
                <label><input type="radio" id="ee" name="E" value="ee"> ee - rautias</label>
            </fieldset>

            <fieldset>
                <legend>Ruunikkotekijä - emä</legend>
                <label><input type="radio" id="AA" name="A" value="AA" checked> AA - ruunikko</label><br>
                <label><input type="radio" id="Aa" name="A" value="Aa"> Aa - ruunikko mustan kantaja</label><br>
                <label><input type="radio" id="aa" name="A" value="aa"> aa - musta</label>
            </fieldset>

            <fieldset>
                <legend>Voikkotekijä - emä</legend>
                <label><input type="radio" id="cc" name="C" value="cc" checked> CC - ei-voikko</label><br>
                <label><input type="radio" id="Cc" name="C" value="Cc"> CrC - voikko</label><br>
                <label><input type="radio" id="CC" name="C" value="CC"> CrCr - valkovoikko</label>
            </fieldset>

            <fieldset>
                <legend>Kimotekijä - emä</legend>
                <label><input type="radio" id="GG" name="G" value="GG" checked> GG - kimo</label><br>
                <label><input type="radio" id="Gg" name="G" value="Gg"> Gg - kimo</label><br>
                <label><input type="radio" id="gg" name="G" value="gg"> gg - ei-kimo</label>
            </fieldset>
            <fieldset>
                <legend>Kirjavuustekijä - emä</legend>
                <label><input type="radio" id="TT" name="TO" value="TT"> TOTO - tobianokirjava</label><br>
                <label><input type="radio" id="Tt" name="TO" value="Tt"> TOto - tobianokirjava </label><br>
                <label><input type="radio" id="tt" name="TO" value="tt" checked> toto - ei-kirjava</label>
            </fieldset>
            <fieldset>
                <legend>Hopeatekijä - emä</legend>
                <label><input type="radio" id="ZZ" name="Z" value="ZZ"> ZZ - hopea</label><br>
                <label><input type="radio" id="Zz" name="Z" value="Zz"> Zz - hopea </label><br>
                <label><input type="radio" id="zz" name="Z" value="zz" checked> zz - ei-hopea</label>
            </fieldset>
            <fieldset>
                <legend>Hallakkotekijä - emä</legend>
                <label><input type="radio" id="DD" name="D" value="DD"> DD - hallakko</label><br>
                <label><input type="radio" id="Dd" name="D" value="Dd"> Dd - hallakko </label><br>
                <label><input type="radio" id="dd" name="D" value="dd" checked> dd - ei-hallakko</label>
            </fieldset>
        </form>


        <form id="genotype-form-sire" onchange="updateSireGenotype()">
            <fieldset>
                <legend>Rautiastekijä - isä</legend>
                <label><input type="radio" id="EE" name="Es" value="EE" checked> EE - ei-rautias</label><br>
                <label><input type="radio" id="Ee" name="Es" value="Ee"> Ee - ei-rautias kantaja</label><br>
                <label><input type="radio" id="ee" name="Es" value="ee"> ee - rautias</label>
            </fieldset>

            <fieldset>
                <legend>Ruunikkotekijä - isä</legend>
                <label><input type="radio" id="AA" name="As" value="AA" checked> AA - ruunikko</label><br>
                <label><input type="radio" id="Aa" name="As" value="Aa"> Aa - ruunikko mustan kantaja</label><br>
                <label><input type="radio" id="aa" name="As" value="aa"> aa - musta</label>
            </fieldset>

            <fieldset>
                <legend>Voikkotekijä - isä</legend>
                <label><input type="radio" id="cc" name="Cs" value="cc" checked> CC - ei-voikko</label><br>
                <label><input type="radio" id="Cc" name="Cs" value="Cc"> CrC - voikko</label><br>
                <label><input type="radio" id="CC" name="Cs" value="CC"> CrCr - valkovoikko</label>
            </fieldset>

            <fieldset>
                <legend>Kimotekijä - isä</legend>
                <label><input type="radio" id="GG" name="Gs" value="GG" checked> GG - kimo</label><br>
                <label><input type="radio" id="Gg" name="Gs" value="Gg"> Gg - kimo</label><br>
                <label><input type="radio" id="gg" name="Gs" value="gg"> gg - ei-kimo</label>
            </fieldset>
            <fieldset>
                <legend>Kirjavuustekijä - isä</legend>
                <label><input type="radio" id="TT" name="TOs" value="TT"> TOTO - tobianokirjava</label><br>
                <label><input type="radio" id="Tt" name="TOs" value="Tt"> TOto - tobianokirjava </label><br>
                <label><input type="radio" id="tt" name="TOs" value="tt" checked> toto - ei-kirjava</label>
            </fieldset>
            <fieldset>
                <legend>Hopeatekijä - isä</legend>
                <label><input type="radio" id="ZZ" name="Zs" value="ZZ"> ZZ - hopea</label><br>
                <label><input type="radio" id="Zz" name="Zs" value="Zz"> Zz - hopea </label><br>
                <label><input type="radio" id="zz" name="Zs" value="zz" checked> zz - ei-hopea</label>
            </fieldset>
            <fieldset>
                <legend>Hallakkotekijä - isä</legend>
                <label><input type="radio" id="DD" name="Ds" value="DD"> DD - hallakko</label><br>
                <label><input type="radio" id="Dd" name="Ds" value="Dd"> Dd - hallakko </label><br>
                <label><input type="radio" id="dd" name="Ds" value="dd" checked> dd - ei-hallakko</label>
            </fieldset>
        </form>
    </div>


    </div>
    <div style="display: flex;">
        <button onclick="generateFoal()"> Generoi varsa</button>
        <div id="foal-genotype-display" style="font-family: monospace; margin: 8px;"> Varsan genotyyppi: -- -- -- -- --
            --
        </div>
        <div id="foal-sex-display" style="font-family: monospace; margin: 8px; margin-left: 16px;"> Sukupuoli: - </div>
    </div>
    <!-- <button onclick="logCoordsAsArray()"> log</button> -->
    <div id="text">
        <h4> Simulaattorista ja värigeeneistä</h4>

        Rautiaan hevosen karvapeite ja jouhet ovat ruskeat. Ruunikko hevonen on sen sijaan ruskea mustilla jouhilla ja
        yleensä myös sen jalat ovat mustat.
        Rautiastekijä vaikuttaa ruunikkotekijän ilmenemiseen: EE- tai Ee-yksilöt voivat olla ulkoisesti ruunikkoja tai
        mustia,
        mutta ee-yksilö on rautias riippumatta siitä, mikä sen genotyyppi ruunikkotekijän osalta on. <br><br>
        Rautias, ruunikko ja musta ovat perusvärejä, joita muut tekijät voivat vaalentaa.
        Voikkotekijä vaalentaa ruunikon ruunivoikoksi, jolla on tumma harja ja vaaleanruskea karva, kun taas rautiaan se
        vaalentaa
        niin, että harjasta tulee valkoinen ja karvasta vaaleanruskea (klassinen voikko). Voikkotekijä mustalla pohjalla
        vaalentaa ainoastaan karvaa hieman, tehden siitä tummanruskean (mustanvoikko). <br><br>

        Kimotekijä voi vaalentaa minkä tahansa muun värin hevosen ikääntyessä: kimot syntyvät pohjavärinsä värisinä ja
        harmaantuvat vähitellen,
        kunnes ne ovat valkoisia tai lähes valkoisia. Tässä simulaatiossa kimoutta kuvaa aina sama harmaa väri, vaikka
        todellisuudessa
        kimon hevosen väritys riippuu sen pohjaväristä, iästä ja muista tekijöistä. Simulaation hevosilla olevat vaaleat
        pilkut kuvaavat kimoilla hevosilla yleistä
        papurikkokuviointia, jota ei kuitenkaan esiinny aivan kaikilla kimoilla. <br><br>


        Kirjavuus voi esiintyä minkä tahansa muun värin ohella eikä vaikuta tämän pohjavärin sävyihin - se ainoastaan
        lisää valkoisia, pohjavärin "peittäviä" laikkuja
        eri puolille hevosen kehoa. <br><br>

        Hopeageeni vaikuttaa mustaan pigmenttiin ja vaalentaa mustan harjan hopeisen vaaleaksi. Rautiaalla hevosella sen
        vaikutus ei näy.
        Mustan pohjavärin hopeageeni sen sijaan vaalentaa ja lisäksi on tyypillistä, että se aiheuttaa vaaleita
        papurikkokuvioita.

        <h4> Tehtävät</h4>
        Yksilöllä on kaksi alleelia, joista toinen periytyy sen jälkeläiselle. Valinta on satunnainen eli kummallakin
        alleelilla on 50% mahdollisuus periytyä. Jälkeläisen genotyyppi muodostuu yhdestä isältä peritystä alleelista ja
        yhdestä emältä peritystä alleelista. Eri geenit periytyvät toisistaan riippumattomasti.<br> <br>

        1. Jos emän genotyyppi on CrC ja isän genotyyppi CrC, millä todennäköisyydellä varsan genotyyppi on CrCr? //25%
        <br>
        <br>
        2. Jos emä on rautias ja “piilomusta” (ee + aa), ja isä on ei-rautias ruunikko mustan kantaja (Ee Aa), millä
        todennäköisyydellä varsasta tulee <br>
        a) rautias (ee Aa tai ee aa) // 0.5 * 1 = 50%<br>
        b) ruunikko (Ee Aa) // 0.5 * 0.5 = 25%<br>
        c) musta (Ee aa) ? // 0.5 * 0.5 = 25%<br><br>
        3. Oleta, että voit hankkia minkä tahansa värisiä hevosia ja niiden koko genotyyppi on aina tiedossa. Millaiset
        vanhemmat valitsisit kasvatukseen, jos tavoitteenasi on saada mahdollisimman suurella todennäköisyydellä <br>
        a) voikko jälkeläinen? // CC x CrCr (+ molemmat pohjaltaan rautiaita, ei-kimoja). <br>
        b) kimo jälkeläinen, joka voi kuitenkin itse tuottaa ei-kimoja jälkeläisiä seuraavissa sukupolvissa riippumatta
        toisen vanhemman genotyypistä? // (GG x gg)<br>
        c) ruunivoikko jälkeläinen, eli sellainen, joka on genotyypiltään ei-rautias + ruunikko + voikko. // EE AA CC x
        EE
        AA CrCr => EE AA CrC <br>
        d) musta jälkeläinen, joka voi itse tuottaa rautiaita jälkeläisiä? // aa ee x aa EE (+molemmat myös ei-voikkoja,
        ei-kimoja)<br>


    </div>


    <script>
        const board = JXG.JSXGraph.initBoard('box', {
            boundingbox: [-15, 17.5, 15, -17.5],
            axis: false,
            showCopyright: false,
            zoom: {
                enabled: false
            },
            showNavigation: false

        });

        const horseColors = {
            brown: '#8B5E3C',
            darkerbrown: '#714A30',
            darkbrown: '#1f1915',
            black: '#080808',
            almostblack: '#0f0f0f',
            silverblack: '#2e2926',
            silvercreamblack: '#453a35',
            beige: '#D7B89C',
            lighterbeige: '#e6e1db',
            darkgrey: '#5E5E5E',
            grey: '#A8A8A8',
            offwhite: '#F1EDE5',
            white: '#FAFAFA'
        };

        const horseBaseCoords =
            [[-1.233, 3.867],
            [-5.164, 0.267],
            [-5.534, -0.433],
            [-5.16, -1.5],
            [-4.082, -1.767],
            [-3.513, -1.3],
            [-2.356, -1.067],
            [-1.121, -0.967],
            [-0.434, -0.5],
            [0.213, -3.633],
            [1.057, -5.567],
            [3.348, -3.4],
            [5.327, -0.467],
            [1.904, 3.367],
            [-0.188, 4.033],
            [-0.636, 4.467],
            [-1.671, 5.433]];

        const maneCoords = [
            [-0.434, 4.067],
            [0.213, 2.967],
            [0.313, 2.4],
            [0.843, 1.1],
            [1.256, 2.033],
            [1.669, 0],
            [2.121, 0.867],
            [2.417, -1.9],
            [3.065, -1.3],
            [3.673, -3.433],
            [4.047, -1.867],
            [4.499, -2.767],
            [5.499, -0.233],
            [3.485, 2.4],
            [1.198, 3.9]];

        const frontLockCoords = [
            [-2.939, 3.7],
            [-3.779, 2.833],
            [-3.444, 2.767],
            [-3.775, 2.033],
            [-3.284, 2.3],
            [-3.223, 1.7],
            [-2.301, 2.367],
            [-1.145, 3.9],
            [-1.241, 4.233]]

        const tobianoCoords =
            [[1.252, 0.6],
            [0.704, -1.1],
            [1.096, -1.767],
            [1.331, -2.5],
            [1.096, -3.1],
            [1.252, -3.8],
            [0.683, -4.666],
            [1.057, -5.567],
            [3.348, -3.4],
            [5.249, -0.5],
            [2.021, 1.033]]

        const dappleCoords = [
            [2.331, -2.3],
            [1.3, -3.0],
            [2, -3.432],
            [1, 1.45],
            [1, -4.23],
            [1.5, -0.99],
            [0.5, -2.8],
            [0.63, 0.65],
            [1.8, -0.1],
            [0.07, 1.92],
            [0.18, 1.28],
            [3, -1.5],
            [-0.5, 0.3],

        ]

        const maneStripeCoords = [
            [1.16, 3.964],
            [0.011, 4.036],
            [0.634, 2.869],
            [0.869, 3.545],
            [1.743, 2.536],
            [2.038, 1.609],
            [2.486, 2.516],
            [2.999, 0.206],
            [3.394, 1.872],
            [4.186, -1],
            [4.517, -0.012],
            [5.131, -1.227],
            [5.501, -0.136],
            [3.606, 2.318]];

        const mane1Points = [], frontLock1Points = [], tobiano1Points = [], horse1Points = [], dapple1Points = [], stripe1Points = [];
        const mane2Points = [], frontLock2Points = [], tobiano2Points = [], horse2Points = [], dapple2Points = [], stripe2Points = [];
        const mane3Points = [], frontLock3Points = [], tobiano3Points = [], horse3Points = [], dapple3Points = [], stripe3Points = [];

        function addMirroredPoints(coords, offsetX, offsetY, arr1, arr2, arr3) {
            coords.forEach(([x, y]) => {
                arr1.push(board.create('point', [x - offsetX, y + offsetY], { visible: false, opacity: 0 }));
                arr2.push(board.create('point', [x + offsetX, y + offsetY], { visible: false, opacity: 0 }));
                arr3.push(board.create('point', [x, y - offsetY], { visible: false, opacity: 0 }));
            });
        }

        addMirroredPoints(maneCoords, 7.5, 7.5, mane1Points, mane2Points, mane3Points);
        addMirroredPoints(frontLockCoords, 7.5, 7.5, frontLock1Points, frontLock2Points, frontLock3Points);
        addMirroredPoints(tobianoCoords, 7.5, 7.5, tobiano1Points, tobiano2Points, tobiano3Points);
        addMirroredPoints(horseBaseCoords, 7.5, 7.5, horse1Points, horse2Points, horse3Points);
        addMirroredPoints(maneStripeCoords, 7.5, 7.5, stripe1Points, stripe2Points, stripe3Points);



        function createFlatPolygon(points, fillColor) {
            return board.create('polygon', [...points], {
                fillColor,
                fillOpacity: 1,
                highlight: false,
                borders: { visible: false }
            });
        }
        function createDapples(points, color) {
            points.forEach((point, i) =>
                point.setAttribute({ visible: false, color: 'white', size: 6 - (i % 5), layer: 3, fillOpacity: 0.3, strokeOpacity: 0 })
            )
        }

        addMirroredPoints(dappleCoords, 7.5, 7.5, dapple1Points, dapple2Points, dapple3Points);
        const horse1Shape = createFlatPolygon(horse1Points, 'white');
        createDapples(dapple1Points, 'white');
        const tobiano1Shape = createFlatPolygon(tobiano1Points, 'white');
        const mane1Shape = createFlatPolygon(mane1Points, 'white');
        const frontLock1Shape = createFlatPolygon(frontLock1Points, 'white');
        const stripe1Shape = createFlatPolygon(stripe1Points, 'black');

        const horse2Shape = createFlatPolygon(horse2Points, 'white');
        createDapples(dapple2Points, 'white');
        const tobiano2Shape = createFlatPolygon(tobiano2Points, 'white');
        const mane2Shape = createFlatPolygon(mane2Points, 'white');
        const frontLock2Shape = createFlatPolygon(frontLock2Points, 'white');
        const stripe2Shape = createFlatPolygon(stripe2Points, 'black');

        const horse3Shape = createFlatPolygon(horse3Points, 'white');
        createDapples(dapple3Points, 'white');
        const tobiano3Shape = createFlatPolygon(tobiano3Points, 'white');
        const mane3Shape = createFlatPolygon(mane3Points, 'white');
        const frontLock3Shape = createFlatPolygon(frontLock3Points, 'white');
        const stripe3Shape = createFlatPolygon(stripe3Points, 'black');

        //set tobiano and dorsal stripe off at the start
        tobiano1Shape.setAttribute({ visible: false });
        tobiano2Shape.setAttribute({ visible: false });
        tobiano3Shape.setAttribute({ visible: false });
        stripe1Shape.setAttribute({ visible: false });
        stripe2Shape.setAttribute({ visible: false });
        stripe3Shape.setAttribute({ visible: false });

        function toggleDapples(points, dapplesOn) {
            points.forEach((point, i) => {
                point.setAttribute({ visible: dapplesOn });
            })
        };

        //"family tree" lines
        const leftTop = board.create('point', [-7.5, 1], { visible: false });
        const leftBottom = board.create('point', [-7.5, -0.5], { visible: false });
        const rightTop = board.create('point', [7.5, 1], { visible: false });
        const rightBottom = board.create('point', [7.5, -0.5], { visible: false });
        const center = board.create('point', [0, -0.5], { visible: false });
        const centerBottom = board.create('point', [0, -1.5], { visible: false });

        board.create('line', [leftTop, leftBottom], { straightFirst: false, straightLast: false, strokeColor: 'grey', strokeWidth: 1 })
        board.create('line', [rightTop, rightBottom], { straightFirst: false, straightLast: false, strokeColor: 'grey', strokeWidth: 1 })
        board.create('line', [leftBottom, rightBottom], { straightFirst: false, straightLast: false, strokeColor: 'grey', strokeWidth: 1 })
        board.create('line', [center, centerBottom], { straightFirst: false, straightLast: false, strokeColor: 'grey', strokeWidth: 1 })


        let selectedHorseGenotype = {
            eLocus: 'EE',
            aLocus: 'AA',
            cLocus: 'CC',
            gLocus: 'GG',
            toLocus: 'tt',
            zLocus: 'zz',
            dLocus: 'dd',
        }
        let foalGenotype = {
            eLocus: 'EE',
            aLocus: 'AA',
            cLocus: 'CC',
            gLocus: 'GG',
            toLocus: 'tt',
            zLocus: 'zz',
            dLocus: 'dd',
        }
        let damGenotype = {
            eLocus: 'EE',
            aLocus: 'AA',
            cLocus: 'CC',
            gLocus: 'GG',
            toLocus: 'tt',
            zLocus: 'zz',
            dLocus: 'dd',
        }
        let sireGenotype = {
            eLocus: 'EE',
            aLocus: 'AA',
            cLocus: 'CC',
            gLocus: 'GG',
            toLocus: 'tt',
            zLocus: 'zz',
            dLocus: 'dd'
        }

        const alleleMap = {
            c: 'C',
            C: 'Cr',
            T: 'TO',
            t: 'to',
        };

        function expandAllelePair(pair) {
            return pair
                .split('')
                .map(allele => alleleMap[allele] || allele)
                .join('');
        }

        function updateDamGenotype() {
            selectedHorseGenotype.eLocus = document.querySelector('input[name="E"]:checked')?.value || '';
            selectedHorseGenotype.aLocus = document.querySelector('input[name="A"]:checked')?.value || '';
            selectedHorseGenotype.cLocus = document.querySelector('input[name="C"]:checked')?.value || '';
            selectedHorseGenotype.gLocus = document.querySelector('input[name="G"]:checked')?.value || '';
            selectedHorseGenotype.toLocus = document.querySelector('input[name="TO"]:checked')?.value || '';
            selectedHorseGenotype.zLocus = document.querySelector('input[name="Z"]:checked')?.value || '';
            selectedHorseGenotype.dLocus = document.querySelector('input[name="D"]:checked')?.value || '';
            updateHorse1Color();
        }
        function updateSireGenotype() {
            selectedHorseGenotype.eLocus = document.querySelector('input[name="Es"]:checked')?.value || '';
            selectedHorseGenotype.aLocus = document.querySelector('input[name="As"]:checked')?.value || '';
            selectedHorseGenotype.cLocus = document.querySelector('input[name="Cs"]:checked')?.value || '';
            selectedHorseGenotype.gLocus = document.querySelector('input[name="Gs"]:checked')?.value || '';
            selectedHorseGenotype.toLocus = document.querySelector('input[name="TOs"]:checked')?.value || '';
            selectedHorseGenotype.zLocus = document.querySelector('input[name="Zs"]:checked')?.value || '';
            selectedHorseGenotype.dLocus = document.querySelector('input[name="Ds"]:checked')?.value || '';
            updateHorse2Color();
        }

        function getBaseColor(genotype) {
            let color = horseColors.brown;
            //E -> default brown either way
            if (genotype.aLocus == 'aa' && genotype.eLocus != 'ee') {
                color = horseColors.almostblack;
            }

            if (genotype.cLocus == 'Cc') {
                color = horseColors.beige;
            }
            if (genotype.cLocus == 'Cc' && genotype.aLocus == 'aa' && genotype.eLocus != 'ee') {
                color = horseColors.darkbrown;
            }
            if (genotype.cLocus == 'CC') {
                color = horseColors.offwhite;
            }

            if (genotype.zLocus != 'zz' && (color == horseColors.almostblack)) {
                color = horseColors.silverblack;
            }
            if (genotype.zLocus != 'zz' && (color == horseColors.darkbrown)) {
                color = horseColors.silvercreamblack;
            }

            if (genotype.gLocus != 'gg') { //ADD effect by cream.
                color = horseColors.grey;
            }
            return color;
        }

        function getManeColor(genotype) {
            let color = horseColors.black;
            if (genotype.eLocus === 'ee') {
                color = horseColors.darkerbrown;
            }

            if (genotype.aLocus == 'aa' && genotype.cLocus == 'Cc') {  //voikko + musta
                color = horseColors.black;
            }
            if (genotype.eLocus == 'ee' && genotype.cLocus == 'Cc') { //voikko + rautias 
                color = horseColors.white;
            }

            if (genotype.cLocus == 'CC') {
                color = horseColors.white;
            }

            if (genotype.gLocus != 'gg') {
                color = horseColors.darkgrey;
            }

            if (genotype.zLocus != 'zz' && color == horseColors.black) {
                color = horseColors.lighterbeige;
            }
            return color;
        }

        function updateHorse1Color() {
            damGenotype = { ...selectedHorseGenotype };
            horse1Shape.setAttribute({ fillColor: (getBaseColor(damGenotype)) });
            const maneColor = getManeColor(damGenotype);
            mane1Shape.setAttribute({ fillColor: maneColor });
            frontLock1Shape.setAttribute({ fillColor: maneColor });
            tobiano1Shape.setAttribute({ visible: (damGenotype.toLocus != 'tt' ? true : false) })
            toggleDapples(dapple1Points, (damGenotype.gLocus != 'gg') || (damGenotype.zLocus != 'zz' &&
                damGenotype.aLocus == 'aa' && damGenotype.eLocus != 'ee' && damGenotype.cLocus != 'CC'));
        }

        function updateHorse2Color() {
            sireGenotype = { ...selectedHorseGenotype };
            horse2Shape.setAttribute({ fillColor: (getBaseColor(sireGenotype)) });
            const maneColor = getManeColor(sireGenotype);
            mane2Shape.setAttribute({ fillColor: maneColor });
            frontLock2Shape.setAttribute({ fillColor: maneColor });
            tobiano2Shape.setAttribute({ visible: (sireGenotype.toLocus != 'tt' ? true : false) })
            toggleDapples(dapple2Points, (sireGenotype.gLocus != 'gg') || (sireGenotype.zLocus != 'zz' &&
                sireGenotype.aLocus == 'aa' && sireGenotype.eLocus != 'ee' && sireGenotype.cLocus != 'CC'));

        }

        function updateHorse3Color() {
            horse3Shape.setAttribute({ fillColor: (getBaseColor(foalGenotype)) });
            const maneColor = getManeColor(foalGenotype);
            mane3Shape.setAttribute({ fillColor: maneColor });
            frontLock3Shape.setAttribute({ fillColor: maneColor });
            tobiano3Shape.setAttribute({ visible: (foalGenotype.toLocus != 'tt' ? true : false) })
            toggleDapples(dapple3Points, (foalGenotype.gLocus != 'gg') || (foalGenotype.zLocus != 'zz' &&
                foalGenotype.aLocus == 'aa' && foalGenotype.eLocus != 'ee' && foalGenotype.cLocus != 'CC'));
        }

        function updateFoalGenotypeDisplay() {
            const display = document.getElementById('foal-genotype-display');
            const expanded = Object.values(foalGenotype).map(expandAllelePair);
            display.textContent = "Varsan genotyyppi: " + expanded.join(' ');

        }

        function generateFoal() {
            for (const locus in damGenotype) {
                const damAllele = damGenotype[locus][Math.random() > 0.5 ? 0 : 1];
                const sireAllele = sireGenotype[locus][Math.random() > 0.5 ? 0 : 1]
                foalGenotype[locus] = [damAllele, sireAllele].sort().join('');
            }
            //console.log(damGenotype, sireGenotype, foalGenotype);
            updateHorse3Color();
            updateFoalGenotypeDisplay();
            const sex = Math.random() > 0.5 ? 'Tamma' : 'Ori';
            document.getElementById('foal-sex-display').textContent = 'Sukupuoli: ' + sex;


        }

        updateHorse1Color();
        updateHorse2Color();













        // const eye1 = board.create('point', [-2.05, 2.10], { color: 'black', size: 4});
        // const eyeHL1 = board.create('point', [-1.92, 2.2], { color: 'white', size: 0.1});

        // const moveable = [];
        // maneStripeCoords.forEach(p => {
        //     const point = board.create('point', [p[0], p[1]], { visible: true, size: 1 });
        //     moveable.push(point);
        // })
        // const newhorse1Shape = board.create('polygon', [...moveable], {
        //     fillColor: 'white',
        //     strokeColor: 'black',
        //     strokeWidth: 2,
        //     fillOpacity: 0.8
        // });
        // const horseNewShape = board.create('polygon', [...maneCoords], {
        //     fillColor: 'grey',
        //     strokeColor: 'black',
        //     vertices: { visible: false },
        //     strokeWidth: 2
        // });

        // function logCoordsAsArray() {
        //     const coords = moveable.map(p => {
        //         const [x, y] = p.coords.usrCoords.slice(1);
        //         return [Number(x.toFixed(3)), Number(y.toFixed(3))];
        //     });
        //     console.log(JSON.stringify(coords));
        // }


    </script>

</body>

</html>