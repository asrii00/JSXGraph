<!DOCTYPE html>
<html>

<head>
    <title>JSXGraph Example</title>
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <style>
        #box {
            width: 600px;
            height: 600px;
        }

        #flex {
            display: flex
        }
    </style>
</head>

<body>
    <div id="flex">
        <div id="box" class="jxgbox"></div>
        <div><button onclick="updateHorse1Color()">Set</button></div>
        <div><button onclick="logCoordsAsArray()">log</button></div>

        <div>
            <form id="genotype-form" onchange="updateHorseGenotype()">
                <fieldset>
                    <legend>Rautiastekij채</legend>
                    <label><input type="radio" id="EE" name="E" value="EE" checked> EE - ei-rautias</label><br>
                    <label><input type="radio" id="Ee" name="E" value="Ee"> Ee - ei-rautias kantaja</label><br>
                    <label><input type="radio" id="ee" name="E" value="ee"> ee - rautias</label>
                </fieldset>

                <fieldset>
                    <legend>Ruunikkotekij채</legend>
                    <label><input type="radio" id="AA" name="A" value="AA" checked> AA - ruunikko</label><br>
                    <label><input type="radio" id="Aa" name="A" value="Aa"> Aa - ruunikko mustan kantaja</label><br>
                    <label><input type="radio" id="aa" name="A" value="aa"> aa - musta</label>
                </fieldset>

                <fieldset>
                    <legend>Voikkotekij채</legend>
                    <label><input type="radio" id="CC" name="C" value="CC" checked> CC - ei-voikko</label><br>
                    <label><input type="radio" id="CrC" name="C" value="CrC"> CrC - voikko</label><br>
                    <label><input type="radio" id="CrCr" name="C" value="CrCr"> CrCr - valkovoikko</label>
                </fieldset>

                <fieldset>
                    <legend>Kimotekij채</legend>
                    <label><input type="radio" id="GG" name="G" value="GG" checked> GG - kimo</label><br>
                    <label><input type="radio" id="Gg" name="G" value="Gg"> Gg - kimo</label><br>
                    <label><input type="radio" id="gg" name="G" value="gg"> gg - ei-kimo</label>
                </fieldset>
            </form>
        </div>
    </div>

    <script>
        // EE - ei-rautias, Ee - ei-rautias kantaja, ee - rautias
        // AA - ruunikko, Aa- ruunikko mustan kantaja, aa - musta
        // CC - ei-voikko, CrC - voikko, CrCr - valkovoikko 
        // GG - kimo, Gg - kimo, gg - ei-kimo
        const board = JXG.JSXGraph.initBoard('box', {
            boundingbox: [-15, 15, 15, -15],
            axis: true
        });

        const horseColors = {
            brown: '#8B5E3C',
            darkerbrown: '#714A30',
            darkbrown: '#3E2B20',
            black: '#2F2F2F',
            beige: '#D7B89C',
            darkgrey: '#5E5E5E',
            grey: '#A8A8A8',
            offwhite: '#F1EDE5',
            white: '#FAFAFA'
        };

        const horseBaseCoords =
            [[-1.233, 3.867],
            [-5.164, 0.267],
            [-5.534, -0.433],
            [-5.16, -1.5],
            [-4.082, -1.767],
            [-3.513, -1.3],
            [-2.356, -1.067],
            [-1.121, -0.967],
            [-0.434, -0.5],
            [0.213, -3.633],
            [1.057, -5.567],
            [3.348, -3.4],
            [5.327, -0.467],
            [1.904, 3.367],
            [-0.188, 4.033],
            [-0.636, 4.467],
            [-1.671, 5.433]];

        const maneCoords = [
            [-3.56, 3.43],
            [-3.11, 3.13],
            [-3.62, 2.30],
            [-2.45, 2.35]
        ];

        const maneArray = [
            [-0.434, 4.067],
            [0.213, 2.967],
            [0.313, 2.4],
            [0.843, 1.1],
            [1.256, 2.033],
            [1.669, 0],
            [2.121, 0.867],
            [2.417, -1.9],
            [3.065, -1.3],
            [3.673, -3.433],
            [4.047, -1.867],
            [4.499, -2.767],
            [5.499, -0.233],
            [3.485, 2.4],
            [1.198, 3.9]];

        const frontLockArray = [
            [-2.939, 3.7],
            [-3.779, 2.833],
            [-3.444, 2.767],
            [-3.775, 2.033],
            [-3.284, 2.3],
            [-3.223, 1.7],
            [-2.301, 2.367],
            [-1.145, 3.9],
            [-1.241, 4.233]]

        const tobianoArray =
            [[1.252, 0.6],
            [0.704, -1.1],
            [1.096, -1.767],
            [1.331, -2.5],
            [1.096, -3.1],
            [1.252, -3.8],
            [0.683, -4.666],
            [1.057, -5.567],
            [3.348, -3.4],
            [5.249, -0.5],
            [2.021, 1.033]]


        const mane1Points = [];
        const frontLock1Points = [];
        maneArray.forEach(coord => {
            const point = board.create('point', [coord[0], coord[1]], { visible: false });
            mane1Points.push(point);
        })
        frontLockArray.forEach(coord => {
            const point = board.create('point', [coord[0], coord[1]], { visible: false });
            frontLock1Points.push(point);
        })

        const horse1Points = [];
        const horse2Points = [];
        horseBaseCoords.forEach(coord => {
            const point = board.create('point', [coord[0], coord[1]], { visible: false });
            horse1Points.push(point);
            const point2 = board.create('point', [coord[0] + 7.5, coord[1] + 7.5], { visible: false });
            horse2Points.push(point2);

        })

        const horse1Shape = board.create('polygon', [...horse1Points], {
            fillColor: 'grey',
            borders: {
                visible: false
            },
            highlight: false,
            fillOpacity: 1
        });
        const tobianoShape = board.create('polygon', [...tobianoArray], {
            fillColor: 'white',
            borders: {
                visible: false
            },
            vertices: {
                visible: false
            },

            highlight: false,
            fillOpacity: 1
        });

        const mane1Shape = board.create('polygon', [...mane1Points], {
            fillColor: 'black',
            borders: {
                visible: false
            },
            highlight: false,
            fillOpacity: 1,
        });
        const frontLock1Shape = board.create('polygon', [...frontLock1Points], {
            fillColor: 'black',
            borders: {
                visible: false
            },
            highlight: false,
            fillOpacity: 1
        });

        // const moveable = [];
        // tobianoArray.forEach(p => {
        //     const point = board.create('point', [p[0], p[1]], { visible: true, size: 1 });
        //     moveable.push(point);
        // })
        // const newhorse1Shape = board.create('polygon', [...moveable], {
        //     fillColor: 'white',
        //     strokeColor: 'black',
        //     strokeWidth: 2,
        //     fillOpacity: 0.8
        // });
        // const horse2Shape = board.create('polygon', [...horse2Points], {
        //     fillColor: 'grey',
        //     strokeColor: 'black',
        //     strokeWidth: 2
        // });

        let horseGenotype = {
            eLocus: 'EE',
            aLocus: 'AA',
            cLocus: 'CC',
            gLocus: 'GG',
        }

        function updateHorseGenotype() {
            horseGenotype.eLocus = document.querySelector('input[name="E"]:checked')?.value || '';
            horseGenotype.aLocus = document.querySelector('input[name="A"]:checked')?.value || '';
            horseGenotype.cLocus = document.querySelector('input[name="C"]:checked')?.value || '';
            horseGenotype.gLocus = document.querySelector('input[name="G"]:checked')?.value || '';

            console.log(horseGenotype);
            console.log('base: ', getBaseColor(horseGenotype))
            console.log('mane ', getManeColor(horseGenotype))
        }

        function getBaseColor(genotype) {
            let color = horseColors.brown;
            //E -> default brown either way
            if (genotype.aLocus == 'aa' && genotype.eLocus != 'ee') {
                color = horseColors.black;
            }
            if (genotype.cLocus == 'CrC') {
                color = horseColors.beige;
            }
            console.log(genotype.cLocus, genotype.aLocus)
            if (genotype.cLocus == 'CrC' && genotype.aLocus == 'aa' && genotype.eLocus != 'ee') {
                color = horseColors.darkbrown;
            }

            if (genotype.cLocus == 'CrCr') {
                color = horseColors.offwhite;
            }
            if (genotype.gLocus != 'gg') {
                color = horseColors.grey; // ADD GRADIENT.
            }
            return color;
        }

        function getManeColor(genotype) {
            let color = horseColors.black;
            if (genotype.eLocus === 'ee') {
                color = horseColors.darkerbrown;
            }

            if (genotype.aLocus == 'aa' && genotype.cLocus == 'CrC') {  //voikko + musta
                color = horseColors.black;
            }
            if (genotype.eLocus == 'ee' && genotype.cLocus == 'CrC') { //voikko + rautias 
                color = horseColors.white;
            }

            if (genotype.cLocus == 'CrCr') {
                color = horseColors.white;
            }

            if (genotype.gLocus != 'gg') {
                color = horseColors.darkgrey;
            }
            return color;
        }

        function updateHorse1Color() {
            horse1Shape.setAttribute({ fillColor: (getBaseColor(horseGenotype)) });
            const maneColor = getManeColor(horseGenotype);
            mane1Shape.setAttribute({ fillColor: maneColor });
            frontLock1Shape.setAttribute({ fillColor: maneColor });

        }
        function updateHorse2Color() {
            //horse2Shape.setAttribute({ fillColor: (getBaseColor(horseGenotype)) });
        }

        function logCoordsAsArray() {
            const coords = moveable.map(p => {
                const [x, y] = p.coords.usrCoords.slice(1);
                return [Number(x.toFixed(3)), Number(y.toFixed(3))];
            });
            console.log(JSON.stringify(coords));
        }



    </script>

</body>

</html>