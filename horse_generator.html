<!DOCTYPE html>
<html>

<head>
    <title>JSXGraph Example</title>
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <style>
        #box {
            min-width: 590px;
            height: 600px;
        }

        #text {
            width: 1000px
        }

        #flex {
            display: flex
        }
    </style>
</head>

<body>
    <div id="flex">
        <div id="box" class="jxgbox"></div>
        <div><button onclick="logCoordsAsArray()">log</button></div>

        <div>
            <form id="genotype-form" onchange="updateHorseGenotype()">
                <fieldset>
                    <legend>Rautiastekijä</legend>
                    <label><input type="radio" id="EE" name="E" value="EE" checked> EE - ei-rautias</label><br>
                    <label><input type="radio" id="Ee" name="E" value="Ee"> Ee - ei-rautias kantaja</label><br>
                    <label><input type="radio" id="ee" name="E" value="ee"> ee - rautias</label>
                </fieldset>

                <fieldset>
                    <legend>Ruunikkotekijä</legend>
                    <label><input type="radio" id="AA" name="A" value="AA" checked> AA - ruunikko</label><br>
                    <label><input type="radio" id="Aa" name="A" value="Aa"> Aa - ruunikko mustan kantaja</label><br>
                    <label><input type="radio" id="aa" name="A" value="aa"> aa - musta</label>
                </fieldset>

                <fieldset>
                    <legend>Voikkotekijä</legend>
                    <label><input type="radio" id="CC" name="C" value="CC" checked> CC - ei-voikko</label><br>
                    <label><input type="radio" id="CrC" name="C" value="CrC"> CrC - voikko</label><br>
                    <label><input type="radio" id="CrCr" name="C" value="CrCr"> CrCr - valkovoikko</label>
                </fieldset>

                <fieldset>
                    <legend>Kimotekijä</legend>
                    <label><input type="radio" id="GG" name="G" value="GG" checked> GG - kimo</label><br>
                    <label><input type="radio" id="Gg" name="G" value="Gg"> Gg - kimo</label><br>
                    <label><input type="radio" id="gg" name="G" value="gg"> gg - ei-kimo</label>
                </fieldset>
                <fieldset>
                    <legend>Kirjavuustekijä</legend>
                    <label><input type="radio" id="TOTO" name="TO" value="TOTO" > TOTO - tobianokirjava</label><br>
                    <label><input type="radio" id="TOto" name="TO" value="TOto"> TOto - tobianokirjava </label><br>
                    <label><input type="radio" id="toto" name="TO" value="toto" checked> toto - ei-kirjava</label>
                </fieldset>
            </form>
            <div>
                <button onclick="updateHorse1Color()">Aseta valitut tamman genotyypiksi</button>
            </div>
            <div><button onclick="updateHorse2Color()">Aseta valitut orin genotyypiksi</button></div>
        </div>

    </div>
    <div id="text">
        <h4> Simulaattorista ja värigeeneistä</h4>

        Rautiastekijä vaikuttaa ruunikkotekijän ilmenemiseen: EE- tai Ee-yksilöt voivat olla ulkoisesti ruunikkoja tai
        mustia,
        mutta ee-yksilö on rautias riippumatta siitä, mikä sen genotyyppi ruunikkotekijän osalta on. <br>
        Rautias, ruunikko ja musta ovat perusvärejä, joita muut tekijät voivat vaalentaa.
        Voikkotekijä vaalentaa ruunikon ruunivoikoksi, jolla on tumma harja ja vaaleanruskea karva, kun taas rautiaan se
        vaalentaa
        niin, että harjasta tulee valkoinen ja karvasta vaaleanruskea (klassinen voikko). Voikkotekijä mustalla pohjalla
        vaalentaa ainoastaan karvaa hieman, tehden siitä tummanruskean (mustanvoikko). <br>

        Kimotekijä voi vaalentaa minkä tahansa muun värin hevosen ikääntyessä: kimot syntyvät pohjavärinsä värisinä ja harmaantuvat vähitellen, 
        kunnes ne ovat valkoisia tai lähes valkoisia. Tässä simulaatiossa kimoutta kuvaa harmaa väri. 

        Kirjavuus voi esiintyä minkä tahansa muun värin ohella eikä vaikuta tämän pohjavärin sävyihin - se ainoastaan lisää valkoisia, pohjavärin "peittäviä" laikkuja
        eri puolille hevosen kehoa. 

        <h4> Tehtävät</h4>
        Yksilöllä on kaksi alleelia, joista toinen periytyy sen jälkeläiselle. Valinta on satunnainen eli kummallakin
        alleelilla on 50% mahdollisuus periytyä. Jälkeläisen genotyyppi muodostuu yhdestä isältä peritystä alleelista ja
        yhdestä emältä peritystä alleelista. Eri geenit periytyvät toisistaan riippumattomasti.<br> <br>

        1. Jos emän genotyyppi on CrC ja isän genotyyppi CrC, millä todennäköisyydellä varsan genotyyppi on CrCr? //25%
        <br>
        <br>
        2. Jos emä on rautias ja “piilomusta” (ee + aa), ja isä on ei-rautias ruunikko mustan kantaja (Ee Aa), millä
        todennäköisyydellä varsasta tulee <br>
        a) rautias (ee Aa tai ee aa) // 0.5 * 1 = 50%<br>
        b) ruunikko (Ee Aa) // 0.5 * 0.5 = 25%<br>
        c) musta (Ee aa) ? // 0.5 * 0.5 = 25%<br><br>
        3. Oleta, että voit hankkia minkä tahansa värisiä hevosia ja niiden koko genotyyppi on aina tiedossa. Millaiset
        vanhemmat valitsisit kasvatukseen, jos tavoitteenasi on saada mahdollisimman suurella todennäköisyydellä <br>
        a) voikko jälkeläinen? // CC x CrCr (+ molemmat pohjaltaan rautiaita, ei-kimoja). <br>
        b) kimo jälkeläinen, joka voi kuitenkin itse tuottaa ei-kimoja jälkeläisiä seuraavissa sukupolvissa riippumatta
        toisen vanhemman genotyypistä? // (GG x gg)<br>
        c) ruunivoikko jälkeläinen, eli sellainen, joka on genotyypiltään ei-rautias + ruunikko + voikko. // EE AA CC x
        EE
        AA CrCr => EE AA CrC <br>
        d) musta jälkeläinen, joka voi itse tuottaa rautiaita jälkeläisiä? // aa ee x aa EE (+molemmat myös ei-voikkoja,
        ei-kimoja)<br>


    </div>


    <script>
        const board = JXG.JSXGraph.initBoard('box', {
            boundingbox: [-15, 15, 15, -15],
            axis: false,
            showCopyright: false,

        });

        const horseColors = {
            brown: '#8B5E3C',
            darkerbrown: '#714A30',
            darkbrown: '#3E2B20', //make a little greyer
            black: '#2F2F2F',
            beige: '#D7B89C',
            darkgrey: '#5E5E5E',
            grey: '#A8A8A8',
            offwhite: '#F1EDE5',
            white: '#FAFAFA'
        };

        const horseBaseCoords =
            [[-1.233, 3.867],
            [-5.164, 0.267],
            [-5.534, -0.433],
            [-5.16, -1.5],
            [-4.082, -1.767],
            [-3.513, -1.3],
            [-2.356, -1.067],
            [-1.121, -0.967],
            [-0.434, -0.5],
            [0.213, -3.633],
            [1.057, -5.567],
            [3.348, -3.4],
            [5.327, -0.467],
            [1.904, 3.367],
            [-0.188, 4.033],
            [-0.636, 4.467],
            [-1.671, 5.433]];

        const maneCoords = [
            [-0.434, 4.067],
            [0.213, 2.967],
            [0.313, 2.4],
            [0.843, 1.1],
            [1.256, 2.033],
            [1.669, 0],
            [2.121, 0.867],
            [2.417, -1.9],
            [3.065, -1.3],
            [3.673, -3.433],
            [4.047, -1.867],
            [4.499, -2.767],
            [5.499, -0.233],
            [3.485, 2.4],
            [1.198, 3.9]];

        const frontLockCoords = [
            [-2.939, 3.7],
            [-3.779, 2.833],
            [-3.444, 2.767],
            [-3.775, 2.033],
            [-3.284, 2.3],
            [-3.223, 1.7],
            [-2.301, 2.367],
            [-1.145, 3.9],
            [-1.241, 4.233]]

        const tobianoCoords =
            [[1.252, 0.6],
            [0.704, -1.1],
            [1.096, -1.767],
            [1.331, -2.5],
            [1.096, -3.1],
            [1.252, -3.8],
            [0.683, -4.666],
            [1.057, -5.567],
            [3.348, -3.4],
            [5.249, -0.5],
            [2.021, 1.033]]


        const mane1Points = [], frontLock1Points = [], tobiano1Points = [], horse1Points = [];
        const mane2Points = [], frontLock2Points = [], tobiano2Points = [], horse2Points = [];

        function addMirroredPoints(coords, offsetX, offsetY, arr1, arr2) {
            coords.forEach(([x, y]) => {
                arr1.push(board.create('point', [x - offsetX, y + offsetY], { visible: false }));
                arr2.push(board.create('point', [x + offsetX, y + offsetY], { visible: false }));
            });
        }

        addMirroredPoints(maneCoords, 7.5, 7.5, mane1Points, mane2Points);
        addMirroredPoints(frontLockCoords, 7.5, 7.5, frontLock1Points, frontLock2Points);
        addMirroredPoints(tobianoCoords, 7.5, 7.5, tobiano1Points, tobiano2Points);
        addMirroredPoints(horseBaseCoords, 7.5, 7.5, horse1Points, horse2Points);


        function createFlatPolygon(points, fillColor) {
            return board.create('polygon', [...points], {
                fillColor,
                fillOpacity: 1,
                highlight: false,
                borders: { visible: false }
            });
        }

        const horse1Shape = createFlatPolygon(horse1Points, 'grey');
        const tobiano1Shape = createFlatPolygon(tobiano1Points, 'white');
        const mane1Shape = createFlatPolygon(mane1Points, 'black');
        const frontLock1Shape = createFlatPolygon(frontLock1Points, 'black');

        const horse2Shape = createFlatPolygon(horse2Points, 'grey');
        const tobiano2Shape = createFlatPolygon(tobiano2Points, 'white');
        const mane2Shape = createFlatPolygon(mane2Points, 'black');
        const frontLock2Shape = createFlatPolygon(frontLock2Points, 'black');

        //set tobiano off at the start
        tobiano1Shape.setAttribute({visible: false});
        tobiano2Shape.setAttribute({visible: false});


        let selectedHorseGenotype = {
            eLocus: 'EE',
            aLocus: 'AA',
            cLocus: 'CC',
            gLocus: 'GG',
            toLocus: 'toto'
        }
        let damGenotype = {
            eLocus: 'EE',
            aLocus: 'AA',
            cLocus: 'CC',
            gLocus: 'GG',
            toLocus: 'toto'
        }
        let sireGenotype = {
            eLocus: 'EE',
            aLocus: 'AA',
            cLocus: 'CC',
            gLocus: 'GG',
            toLocus: 'toto'
        }

        function updateHorseGenotype() {
            selectedHorseGenotype.eLocus = document.querySelector('input[name="E"]:checked')?.value || '';
            selectedHorseGenotype.aLocus = document.querySelector('input[name="A"]:checked')?.value || '';
            selectedHorseGenotype.cLocus = document.querySelector('input[name="C"]:checked')?.value || '';
            selectedHorseGenotype.gLocus = document.querySelector('input[name="G"]:checked')?.value || '';
            selectedHorseGenotype.toLocus = document.querySelector('input[name="TO"]:checked')?.value || '';

            console.log(selectedHorseGenotype);
            console.log('base: ', getBaseColor(selectedHorseGenotype))
            console.log('mane ', getManeColor(selectedHorseGenotype))
        }

        function getBaseColor(genotype) {
            let color = horseColors.brown;
            //E -> default brown either way
            if (genotype.aLocus == 'aa' && genotype.eLocus != 'ee') {
                color = horseColors.black;
            }
            if (genotype.cLocus == 'CrC') {
                color = horseColors.beige;
            }
            console.log(genotype.cLocus, genotype.aLocus)
            if (genotype.cLocus == 'CrC' && genotype.aLocus == 'aa' && genotype.eLocus != 'ee') {
                color = horseColors.darkbrown;
            }

            if (genotype.cLocus == 'CrCr') {
                color = horseColors.offwhite;
            }
            if (genotype.gLocus != 'gg') { //ADD effect by cream.
                color = horseColors.grey; // ADD GRADIENT.
            }
            return color;
        }

        function getManeColor(genotype) {
            let color = horseColors.black;
            if (genotype.eLocus === 'ee') {
                color = horseColors.darkerbrown;
            }

            if (genotype.aLocus == 'aa' && genotype.cLocus == 'CrC') {  //voikko + musta
                color = horseColors.black;
            }
            if (genotype.eLocus == 'ee' && genotype.cLocus == 'CrC') { //voikko + rautias 
                color = horseColors.white;
            }

            if (genotype.cLocus == 'CrCr') {
                color = horseColors.white;
            }

            if (genotype.gLocus != 'gg') {
                color = horseColors.darkgrey;
            }
            return color;
        }

        function updateHorse1Color() {
            damGenotype = selectedHorseGenotype;
            horse1Shape.setAttribute({ fillColor: (getBaseColor(damGenotype)) });
            const maneColor = getManeColor(damGenotype);
            mane1Shape.setAttribute({ fillColor: maneColor });
            frontLock1Shape.setAttribute({ fillColor: maneColor });
            tobiano1Shape.setAttribute({visible: (damGenotype.toLocus != 'toto' ? true : false)})

        }
        function updateHorse2Color() {
            sireGenotype = selectedHorseGenotype;
            horse2Shape.setAttribute({ fillColor: (getBaseColor(sireGenotype)) });
            const maneColor = getManeColor(sireGenotype);
            mane2Shape.setAttribute({ fillColor: maneColor });
            frontLock2Shape.setAttribute({ fillColor: maneColor });
            tobiano2Shape.setAttribute({visible: (sireGenotype.toLocus != 'toto' ? true : false)})
        }















        // const eye1 = board.create('point', [-2.05, 2.10], { color: 'black', size: 4});
        // const eyeHL1 = board.create('point', [-1.92, 2.2], { color: 'white', size: 0.1});

        // const moveable = [];
        // tobianoCoords.forEach(p => {
        //     const point = board.create('point', [p[0], p[1]], { visible: true, size: 1 });
        //     moveable.push(point);
        // })
        // const newhorse1Shape = board.create('polygon', [...moveable], {
        //     fillColor: 'white',
        //     strokeColor: 'black',
        //     strokeWidth: 2,
        //     fillOpacity: 0.8
        // });
        // const horse2Shape = board.create('polygon', [...horse2Points], {
        //     fillColor: 'grey',
        //     strokeColor: 'black',
        //     strokeWidth: 2
        // });

        // function logCoordsAsArray() {
        //     const coords = moveable.map(p => {
        //         const [x, y] = p.coords.usrCoords.slice(1);
        //         return [Number(x.toFixed(3)), Number(y.toFixed(3))];
        //     });
        //     console.log(JSON.stringify(coords));
        // }


    </script>

</body>

</html>