<!DOCTYPE html>
<html>

<head>
    <title>Collie trait plot</title>
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <style>
        #box {
            width: 1200px;
            height: 600px;
        }
    </style>
</head>

<body>

    <div id="box"></div>

    <script src="aggression_by_sex.js"></script>

    <script>
        //male:
        //  1:  0.651 %
        //  2:  0.263 %
        //  3:  0.028 %
        //  4:  0.042 %
        //  5:  0.016 %

        //female:
        //  1:  0.668 %
        //  2:  0.240 %
        //  3:  0.030 %
        //  4:  0.050 %
        //  5:  0.012 %
        //  F:  495 M:  763
       
    const board = JXG.JSXGraph.initBoard('box', {
        boundingbox: [-1, 1.05, 6, 0],
        axis: false,
        showCopyright: false,
        showNavigation: false
    });

    const trait = 'Erratic';

    function getScoreDistribution(data, yKey) {
        const counts = [0, 0, 0, 0, 0]; // index 0 = score 1
        data.forEach(entry => {
            const score = entry[yKey];
            if (score >= 1 && score <= 5) {
                counts[score - 1]++;
            }
        });
        const total = counts.reduce((a, b) => a + b, 0);
        const percentages = counts.map(c => c / total);
        return { percentages, total };
    }

    const maleData = getScoreDistribution(maleDogs, trait);
    const femaleData = getScoreDistribution(femaleDogs, trait);

    const barWidth = 0.3;
    const spacing = 1;

    for (let i = 0; i < 5; i++) {
        const score = i + 1;
        const xBase = spacing * i + 1;

        // Male bar
        const x1 = xBase - barWidth;
        const x2 = xBase;
        const y = maleData.percentages[i];
        board.create('polygon', [
            [x1, 0],
            [x2, 0],
            [x2, y],
            [x1, y]
        ], {
            fillColor: '#4472c4',
            fillOpacity: 0.6,
            borders: { strokeWidth: 0 },
            fixed: true
        });

        // Female bar
        const x3 = xBase;
        const x4 = xBase + barWidth;
        const yF = femaleData.percentages[i];
        board.create('polygon', [
            [x3, 0],
            [x4, 0],
            [x4, yF],
            [x3, yF]
        ], {
            fillColor: '#c55a11',
            fillOpacity: 0.6,
            borders: { strokeWidth: 0 },
            fixed: true
        });

        // Add score label
        board.create('text', [xBase - 0.05, -0.03, score.toString()], {
            anchorY: 'top',
            fixed: true
        });
    }

    // Add y-axis label percentages
    for (let y = 0.2; y <= 1.0; y += 0.2) {
        board.create('text', [-0.3, y, `${(y * 100).toFixed(0)}%`], {
            anchorX: 'right',
            fixed: true
        });

        board.create('line', [[0, y], [6, y]], {
            straightFirst: false,
            straightLast: false,
            strokeColor: '#ccc',
            dash: 1,
            fixed: true
        });
    }

    // Labels
    board.create('text', [2.5, 1.02, 'Male'], { fontSize: 14 });
    board.create('text', [2.9, 1.02, 'Female'], { fontSize: 14 });

    console.log("Male counts:", maleData.percentages.map(p => p.toFixed(3)));
    console.log("Female counts:", femaleData.percentages.map(p => p.toFixed(3)));
</script>


   

</body>

</html>