<!DOCTYPE html>
<html>

<head>
  <title>JSXGraph Example</title>
  <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
  <style>
    #box {
      width: 1200px;
      height: 600px;
    }

    .flex-container {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      padding: 10px;
    }
  </style>
</head>

<body>
  <div class="flex-container">
    <div id="box" class="jxgbox"></div>
  </div>
  <div style="margin-top: 1em;">
    <label for="base-output">Sekvenssi tekstin√§</label><br>
    <textarea id="base-output" rows="4" cols="99" readonly style="resize: none; font-family: monospace;"></textarea>
  </div>

  <script>
    const board = JXG.JSXGraph.initBoard('box', {
      boundingbox: [-125, 150, 200, -10],
      axis: true,
      showNavigation: true,
      defaultAxes: {
        x: {
          ticks: {
            ticksDistance: 250,  //hide ticks
            minorTicks: 0,
            drawLabels: false, //hide numbers along x axis
            majorHeight: 0 //hide vertical grid lines
          }
        }
      }
    });

    const madeUpData = [
      'ABABBAABABABABAABABBABAABABABBABAABBABAA',
      'ABAAAAABBABBBAABABBBAAABBBABBAABABBABBAA',
      'ABBAAABABABBBABABABBABABABBABBBABABAAABB',
      'ABBBABAABAABABBABABAAABBABABBBBABABABBAB',
      'ABBAAAABABBABBAAABBABABABAAAAABBBBBABAAA', 
      'AAAAABBAABAAAAABBBABABABBBABBAAABAAABAAA',
      'BBBABBABBAAABABABAABBBAAAABBBBBAAABABBBA'

    ]
    const coinColors = {
      A: '#99b9ef',
      B: '#a499ef'
    };

    const radius = 5;
    const columns = 10;
    const startX = -110;
    const startY = 65;
    const ySpacing = 15;
    const columnWidth = 7;

    const circles = [];
    const circleLabels = [];
    let results = {};

    const labels = [
      '1', '1', '2', '2', '3', '3', '4', '4',
      '5', '5', '6', '6', '7', '7', '8', '8',
      '9', '9', '10', '10'
    ];

    const xPositions = labels.map((_, i) => {
      const group = Math.floor(i / 2);      // 0 for i=0,1; 1 for i=2,3; etc.
      const offsetInGroup = i % 2;          // 0 for first in pair, 1 for second
      return (2 * columnWidth + 4) * group + columnWidth * offsetInGroup + 10;
    });

    xPositions.forEach((x, i) => {
      board.create('text', [x, -1, labels[i]], {
        anchorX: 'middle',
        anchorY: 'top',
        fontSize: 14
      });
    });

    function drawCircle(x, y, base, color) {
      circles.push(board.create('circle', [
        [x, y], radius
      ], {
        strokeColor: color,
        fillColor: color,
        fillOpacity: 0.8,
        strokeWidth: 2,
        fixed: true
      }));
      circleLabels.push(board.create('text', [
        x, y, base
      ], {
        anchorX: 'middle',
        anchorY: 'middle',
        fontSize: 14,
        fixed: true
      }));
    }

    function getPositionForIndex(index) {
      const x = startX + 2 * radius * (index % columns);
      const y = startY - ySpacing * Math.floor(index / columns);
      return { x: x, y: y };
    }

    function countRuns(seq, result) { //By ChatGPT, couldn't figure this bit out by myself.
      let currentChar = seq[0];
      let runLength = 1;

      for (let i = 1; i < seq.length; i++) {
        if (seq[i] === currentChar) {
          runLength++;
        } else {
          // Store the current run
          if (!result[currentChar]) result[currentChar] = {};
          result[currentChar][runLength] = (result[currentChar][runLength] || 0) + 1;

          currentChar = seq[i];
          runLength = 1;
        }
      }

      // Handle final run
      if (!result[currentChar]) result[currentChar] = {};
      result[currentChar][runLength] = (result[currentChar][runLength] || 0) + 1;

      return result;
    }

    let chart = board.create('chart', [xPositions, [0, 0, 0]], { chartStyle: 'bar', width: 1, }) //doesn't display

    function updateChart() {
      board.removeObject(chart);
      const letters = Object.keys(results); // A, B
      let newData = [];

      const A = results.A;
      const B = results.B;
      let total = 0;

      for (let i = 1; i <= 10; i++) {
        const key = i.toString();
        newData.push(A[key] || 0);  // value from A, or 0 if missing
        total += (A[key] || 0);
        newData.push(B[key] || 0);  // value from B, or 0 if missing
        total += (B[key] || 0);
      }

      chart = board.create('chart', [xPositions, newData],
        {
          chartStyle: 'bar', width: columnWidth,
          colors: [coinColors.A, coinColors.B]
        });
    }

    function drawCoin(side, index, color) {
      const pos = getPositionForIndex(index);
      drawCircle(pos.x, pos.y, side, color);
    }

    function draw(string) {
      for (let i = 0; i < string.length; i++) {
        const side = string[i];
        drawCoin(side, i, coinColors[side])
      }
      document.getElementById('base-output').value = string;
    }

    function loadData() {
      madeUpData.map((_, i) => {
        results = countRuns(madeUpData[i], results);
      });
      draw(madeUpData[0])//draw just one for example
     } 
  
    loadData();
    updateChart();

  </script>

</body>

</html>