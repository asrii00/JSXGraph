<!DOCTYPE html>
<html>

<head>
  <title>JSXGraph Example</title>
  <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
  <style>
    #box {
      width: 1000px;
      height: 600px;
    }

    .flex-container {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      padding: 10px;
    }
  </style>
</head>

<body>

  <div class="flex-container">
    <div id="box" class="jxgbox"></div>
    <iframe src="bigram_prob_table.html" width="250" height="600"></iframe>
  </div>
  <div>
    <button onclick="step()">Generoi seuraava</button>

  </div>
  <script>
    const board = JXG.JSXGraph.initBoard('box', {
      boundingbox: [0, 0, 133, 100],
      axis: false,
      showNavigation: false,
    });
    const yData = [];
    const bigramCounts = [
      [['AA', 1320952],
      ['AC', 639445],
      ['AG', 708838],
      ['AT', 1097113]],
      [['CA', 786382],
      ['CC', 473632],
      ['CG', 355299],
      ['CT', 705263]],
      [['GA', 756041],
      ['GC', 453386],
      ['GG', 470541],
      ['GT', 637132]],
      [['TA', 902974],
      ['TC', 754112],
      ['TG', 782422],
      ['TT', 1313572]]
    ];

    const labels = [
      'AA', 'AC', 'AG', 'AT',
      'CA', 'CC', 'CG', 'CT',
      'GA', 'GC', 'GG', 'GT',
      'TA', 'TC', 'TG', 'TT'
    ];

    const xPositions = labels.map((_, i) => 1.5 * i + 1);
    const percentageData = [];

    bigramCounts.forEach(group => {
      const total = group[0][1] + group[1][1] + group[2][1] + group[3][1];
      group.forEach(bigram => {
        percent = bigram[1] / total;
        percentageData.push(percent)
      })
    })


    const radius = 3;
    const color = '#CA1F26'; // e.g., red for Adenine
    const columns = 20;
    const startX = 10;
    const startY = 10;
    const ySpacing = 10;

    const circles = [];
    const circleLabels = [];

    function drawCircle(x, y, base) {
      circles.push(board.create('circle', [
        [x, y], radius
      ], {
        strokeColor: color,
        fillColor: color,
        fillOpacity: 0.8,
        strokeWidth: 2,
        fixed: true
      }));
      circleLabels.push(board.create('text', [
        x, y, base
      ], {
        anchorX: 'middle',
        anchorY: 'middle',
        fontSize: 14,
        fixed: true
      }));
    }
    
  
    function getPositionForIndex(index){
      const x = startX + 2* radius * (index % columns);
      const y = startY + ySpacing *Math.floor(index / columns);
      return {x: x, y: y};
    }

    function getBase(previousBase){
      if (previousBase === 'A'){

      }
      else if ( previousBase === 'T'){
        
      }
      else if ( previousBase === 'T'){

      }
      else if ( previousBase === 'T'){

      }
    }

    let index = 0;
    const bases =[];

    function step(){
    // get new position
      const pos = getPositionForIndex(index);
      //get random base using probability matrix
      const base = 'A' // getBase(bases[index-1].base? bases[index-1].base : 'A')

      drawCircle(pos.x, pos.y, base);
      bases.push({index: index, x: pos.x, y: pos.y, base: base})
      index ++;
    }
    console.log(percentageData)
  </script>

</body>

</html>